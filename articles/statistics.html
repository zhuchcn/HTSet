<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Differential analysis with HTSet • HTSet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Differential analysis with HTSet">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">HTSet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/enrichment.html">Enrichment Analysis</a>
    </li>
    <li>
      <a href="../articles/statistics.html">Differential analysis with HTSet</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="statistics_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Differential analysis with HTSet</h1>
                        <h4 class="author">Chenghao Zhu</h4>
            
      
      
      <div class="hidden name"><code>statistics.Rmd</code></div>

    </div>

    
    
<style type="text/css">
table.table {
    white-space: nowrap;
}
</style>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(knitr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(kableExtra)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(HTSet)</a></code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>introduction</h2>
<p>High through-put experiments such as RNA-seq, proteomics, and metaboliomics estimate the abundance/concentration of hundrands to millions of features. Very commonly, researchers would like to answer questions such as which gene (or protein, metabolites) were differentially expressed or have differential abundance in treatment groups. Linear model and generalized linear model are widely used because they are highly flaxible to be adopted to different study designs. The <code>HTSet</code> package has a wrapper function <a href="https://zhuchcn.github.io/HTSet/reference/model_fit.html"><code><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit()</a></code></a> of three popular bioconductor packages, including <a href="https://bioconductor.org/packages/release/bioc/html/limma.html">limma</a>, <a href="https://bioconductor.org/packages/release/bioc/html/edgeR.html">edgeR</a>, and <a href="https://bioconductor.org/packages/release/bioc/html/DESeq2.html">DESeq2</a>, that performs differnetial analysis on a high through-put experiment dataset, and it returns the result in an organized structure.</p>
<p>The basic usage of <a href="https://zhuchcn.github.io/HTSet/reference/model_fit.html"><code><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit()</a></code></a> is below.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(object, design, coef, engine, args)</a></code></pre></div>
<p><code>object</code> must be a <code>HTSet</code> object. <code>design</code> is the study design matrix, usually returned by the <code>model.matrix</code> function. <code>coef</code> is the coefficient to perform statistical test. <code>engine</code> must be one of the three backend statistical package mentioned above. <code>args</code> is a list of additional parameters to be parsed to the backend statistical engine.</p>
<p><code>model_fit</code> returns a list-like object. The elemenets that it contains are listed below.</p>
<ul>
<li><p><strong>results:</strong> A <code>data.frame</code> of the statistical test results for each gene/feature in each row. It has 5 columns. <code>logFC</code> has the estimate of the log2-fold-change corresponding to the effect. <code>mean</code> has the average lo2-expression for the gene/feature accross all samples. This is the <code>AveExpr</code> column in limma’s <code>topTable</code> or <code>baseMean</code> in DESeq2’s <code>results</code>. <code>stat</code> is the statistic value of the corresponding test. When using limma, this is the t-statistic value, same as the t column in the result of <code>topTable</code>. For edgeR, this is the f-statistic value for Quansi-likelihood test or the likelihood ratio statistic value for likelihood ratio test. Same as the column F or RT in the result of edgeR’s <code>topTags</code>. As for DESeq2, this is the Wald statistic value for Wald test or the difference in deviance between the reduced model and the full model for likelihood ratio test. same as the <code>stat</code> column in the output of DESeq2’s results. <code>pval</code> is the raw o-value and <code>padj</code> is the p-value after correction for multiple testing.</p></li>
<li><p><strong>adjust.method:</strong> The method used to correct for multiple testing.</p></li>
<li><p><strong>design:</strong> The design matrix</p></li>
<li><p><strong>df:</strong> Degree of freedom for each gene/feature.</p></li>
<li><p><strong>distribution:</strong> The distribution which the <code>stat</code> column in <code>results</code> is compared to generate the <code>pval</code>. This is <code>t</code> for t distribution for limma or DESeq2 with Wald test when <code>useT</code> eqauls to <code>TRUE</code>, <code>f</code> for f distribution for Quansi-likelihood test with edgeR, <code>chisq</code> for chi-squared distribution for likelihood ratio test with edgeR or DESeq2, and <code>norm</code> for DESeq2 with Wald test when <code>useT</code> equals to <code>FALSE</code>.</p></li>
<li><p><strong>engin:</strong> The statistical package used as backend engine.</p></li>
<li><p><strong>coef:</strong> The coefficient tested</p></li>
<li><p><strong>params:</strong> Additional parameters parsed to <code>model_fit</code></p></li>
</ul>
<p>The HTSet package has two dataset included. They both can be loaded using the <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(exrna)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(lipidome)</a></code></pre></div>
<p>In this vignette, we will go though some examples of using <code><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit()</a></code> to perform statistical analysis with the two datasets.</p>
</div>
<div id="backend-engines" class="section level2">
<h2 class="hasAnchor">
<a href="#backend-engines" class="anchor"></a>Backend engines</h2>
<div id="count-data" class="section level3">
<h3 class="hasAnchor">
<a href="#count-data" class="anchor"></a>count data</h3>
<p>High through-put experimental data generated by nucleiic acid sequencing are were usually presented as counts per gene (RNA-seq) or counts per ASV/OTU (16S-seq). Counts data by nature do not fit gaussian distribution, thus linear model is not directly applicable. Thus, the major approches are (1) transforming counts data to continous data and normalized it, and (2) use negative binomial generalized linear model (glm). For the former approch, counts data are often transformed into logCPM followed by linear modeling. Another or a better approach is using <a href="https://bioconductor.org/packages/release/bioc/html/limma.html">limma</a>’s <code>voom</code> function, which estimates the mean-variance relationship of the log-counts, and generates a precision weight for each observation. As for negative binomial glm, <a href="https://bioconductor.org/packages/release/bioc/html/edgeR.html">edgeR</a> and <a href="https://bioconductor.org/packages/release/bioc/html/DESeq2.html">DESeq2</a> two widely recognized packages.</p>
</div>
<div id="exrna" class="section level3">
<h3 class="hasAnchor">
<a href="#exrna" class="anchor"></a>exrna</h3>
<p>The dataset <a href="https://zhuchcn.github.io/HTSet/reference/exrna.html"><code>exrna</code></a> is the small RNA-seq result of isolated HDL from human plasma of 3 patients with systemic lupus erythematosus and 3 healthy control. The raw sequence fastq files were downloaded from GEO (<a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE121865">GSE121865</a>), and processed using the <a href="https://github.com/zhuchcn/exceRNApipeline">exceRNApipeline</a>, using STAR agaist hg38. Gene counts were generated using <a href="https://github.com/simon-anders/htseq">htseq-count</a> agaist gencode’s annotation.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">exrna</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; S4 class: HTSet</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt;   nsamples: 6    nfeatures:1084</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;   sample vars: 28    features vars: 2</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; slots:</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;   $edata: 1084x6 matrix</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;   $fdata: 1084x2 data.frame</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;   $pdata: 6x28 data.frame</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;   $assay: 0 list</span></a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(exrna<span class="op">$</span>pdata[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>)], <span class="dt">format =</span> <span class="st">"html"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>()<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/kableExtra/man/column_spec.html">column_spec</a></span>(<span class="dv">5</span>, <span class="dt">background =</span> <span class="st">"orange"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/kableExtra/man/scroll_box.html">scroll_box</a></span>(<span class="dt">width =</span> <span class="st">"100%"</span>)</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
anatomical_location
</th>
<th style="text-align:left;">
Assay.Type
</th>
<th style="text-align:left;">
BioProject
</th>
<th style="text-align:left;">
Condition
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
SRR8114380
</td>
<td style="text-align:left;">
High density lipoprotein
</td>
<td style="text-align:left;">
ncRNA-Seq
</td>
<td style="text-align:left;">
PRJNA498678
</td>
<td style="text-align:left;background-color: orange !important;">
Systemic Lupus Erythematosus
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114381
</td>
<td style="text-align:left;">
High density lipoprotein
</td>
<td style="text-align:left;">
ncRNA-Seq
</td>
<td style="text-align:left;">
PRJNA498678
</td>
<td style="text-align:left;background-color: orange !important;">
Healthy Control
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114382
</td>
<td style="text-align:left;">
High density lipoprotein
</td>
<td style="text-align:left;">
ncRNA-Seq
</td>
<td style="text-align:left;">
PRJNA498678
</td>
<td style="text-align:left;background-color: orange !important;">
Systemic Lupus Erythematosus
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114383
</td>
<td style="text-align:left;">
High density lipoprotein
</td>
<td style="text-align:left;">
ncRNA-Seq
</td>
<td style="text-align:left;">
PRJNA498678
</td>
<td style="text-align:left;background-color: orange !important;">
Healthy Control
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114384
</td>
<td style="text-align:left;">
High density lipoprotein
</td>
<td style="text-align:left;">
ncRNA-Seq
</td>
<td style="text-align:left;">
PRJNA498678
</td>
<td style="text-align:left;background-color: orange !important;">
Systemic Lupus Erythematosus
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114385
</td>
<td style="text-align:left;">
High density lipoprotein
</td>
<td style="text-align:left;">
ncRNA-Seq
</td>
<td style="text-align:left;">
PRJNA498678
</td>
<td style="text-align:left;background-color: orange !important;">
Healthy Control
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="limma-voom" class="section level3">
<h3 class="hasAnchor">
<a href="#limma-voom" class="anchor"></a>limma voom</h3>
<p>We first create a study design matrix using the <code>model.matrix</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># create the design matrix</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">design =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>( <span class="op">~</span><span class="st"> </span>Condition, <span class="dt">data =</span> exrna<span class="op">$</span>pdata)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(design)</a></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
(Intercept)
</th>
<th style="text-align:right;">
ConditionSystemic Lupus Erythematosus
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
SRR8114380
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114381
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114382
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114383
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114384
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
SRR8114385
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>We are going to test whether each gene is expressed differently between patinets and control, thus the cofficient that we are going to test should be <code>ConditionSystemic Lupus Erythematosus</code> (second column name). We can than call <code>model_fit</code>. Setting <code>voom = TRUE</code> tells <code>model_fit</code> to run <code>voom</code> before calling limma’s <code>lmFit</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">coef =<span class="st"> "ConditionSystemic Lupus Erythematosus"</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">fit1 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(exrna, <span class="dt">design =</span> design, <span class="dt">coef =</span> coef, <span class="dt">engine =</span> <span class="st">"limma"</span>, <span class="dt">args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">voom =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; Loading required namespace: limma</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; Loading required namespace: edgeR</span></a></code></pre></div>
<p>When <code>args</code> has an element named <code>voom</code>, <code>model_fit</code> calls the three functions <code>voom</code>, <code>lmFit</code> and <code>eBayes</code> in order. Additional arguments can be parsed to each of the three functions by assigning a list as value to the key of the corresponding step. For example, <code>voom</code>’s mean-variance trend plot was disabled by default. To enable the plot, parse it in a list to voom, as shown below.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">fit1_<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(exrna, <span class="dt">design =</span> design, <span class="dt">coef =</span> coef, <span class="dt">engine =</span> <span class="st">"limma"</span>, </a>
<a class="sourceLine" id="cb8-2" data-line-number="2">                   <span class="dt">args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">voom =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">plot =</span> <span class="ot">TRUE</span>)))</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Draw a volcano plot</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/volcanoplot.ModelFit.html">volcanoplot</a></span>(fit1, <span class="dt">hline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>P value histogram</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(fit1, <span class="dt">vline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="limma-but-not-voom" class="section level3">
<h3 class="hasAnchor">
<a href="#limma-but-not-voom" class="anchor"></a>limma (but not voom)</h3>
<p>It is also possible to transform count data into logCPM, and use limma directly.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">exrna_cpm =<span class="st"> </span>exrna</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">exrna_cpm<span class="op">$</span>edata =<span class="st"> </span>edgeR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html">cpm</a></span>(exrna_cpm<span class="op">$</span>edata, <span class="dt">prior.count =</span> <span class="dv">1</span>, <span class="dt">log =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">fit2 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(exrna_cpm, <span class="dt">design =</span> design, <span class="dt">coef =</span> coef, <span class="dt">engine =</span> <span class="st">"limma"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">fit2<span class="op">$</span>results[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(fit2<span class="op">$</span>results<span class="op">$</span>pval),] <span class="op">%&gt;%</span><span class="st"> </span>head <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
logFC
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
stat
</th>
<th style="text-align:right;">
pval
</th>
<th style="text-align:right;">
padj
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ENSG00000103769.10
</td>
<td style="text-align:right;">
-2.178666
</td>
<td style="text-align:right;">
8.969559
</td>
<td style="text-align:right;">
-4.596506
</td>
<td style="text-align:right;">
0.0004068
</td>
<td style="text-align:right;">
0.3260259
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000113319.13
</td>
<td style="text-align:right;">
1.578095
</td>
<td style="text-align:right;">
8.107325
</td>
<td style="text-align:right;">
4.240689
</td>
<td style="text-align:right;">
0.0008088
</td>
<td style="text-align:right;">
0.3260259
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000180210.14
</td>
<td style="text-align:right;">
-1.739524
</td>
<td style="text-align:right;">
8.624469
</td>
<td style="text-align:right;">
-4.184622
</td>
<td style="text-align:right;">
0.0009023
</td>
<td style="text-align:right;">
0.3260259
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000232807.2
</td>
<td style="text-align:right;">
1.382317
</td>
<td style="text-align:right;">
8.313330
</td>
<td style="text-align:right;">
3.643572
</td>
<td style="text-align:right;">
0.0026263
</td>
<td style="text-align:right;">
0.6277762
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000231662.1
</td>
<td style="text-align:right;">
-1.215158
</td>
<td style="text-align:right;">
8.191969
</td>
<td style="text-align:right;">
-3.327182
</td>
<td style="text-align:right;">
0.0049367
</td>
<td style="text-align:right;">
0.6277762
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000199804.1
</td>
<td style="text-align:right;">
1.170598
</td>
<td style="text-align:right;">
7.903577
</td>
<td style="text-align:right;">
3.324218
</td>
<td style="text-align:right;">
0.0049660
</td>
<td style="text-align:right;">
0.6277762
</td>
</tr>
</tbody>
</table>
<p>Drawing a volcano plot</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/volcanoplot.ModelFit.html">volcanoplot</a></span>(fit2, <span class="dt">hline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>P value histogram</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(fit2, <span class="dt">vline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div id="deseq2" class="section level3">
<h3 class="hasAnchor">
<a href="#deseq2" class="anchor"></a>DESeq2</h3>
<p>To use DESeq2 to perform negative binomial glm, simply set <code>engine = "DESeq2"</code></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">fit3 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(exrna, <span class="dt">design =</span> design, <span class="dt">coef =</span> coef, <span class="dt">engine =</span> <span class="st">"DESeq2"</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">#&gt; Loading required namespace: DESeq2</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#&gt; using supplied model matrix</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#&gt; estimating size factors</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt; estimating dispersions</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co">#&gt; gene-wise dispersion estimates</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">#&gt; mean-dispersion relationship</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">#&gt; -- note: fitType='parametric', but the dispersion trend was not well captured by the</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co">#&gt;    function: y = a/x + b, and a local regression fit was automatically substituted.</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt;    specify fitType='local' or 'mean' to avoid this message next time.</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt; final dispersion estimates</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co">#&gt; fitting model and testing</span></a></code></pre></div>
<p>Additional parameters can be parsed to the <code>args</code> as a list named as <code>DESeq</code>. The parameters will be used internally by the <code>DESeq</code> function. Use <code>?DESeq</code> to see all parameters that can be used. For example, to use t distribution to estimate p-values:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">fit3_<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">    exrna, <span class="dt">design =</span> design, <span class="dt">coef =</span> coef, <span class="dt">engin =</span> <span class="st">"DESeq2"</span>,</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">    <span class="dt">args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">        <span class="dt">DESeq =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">useT =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">    )</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt; using supplied model matrix</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt; estimating size factors</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; estimating dispersions</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt; gene-wise dispersion estimates</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt; mean-dispersion relationship</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt; -- note: fitType='parametric', but the dispersion trend was not well captured by the</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt;    function: y = a/x + b, and a local regression fit was automatically substituted.</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt;    specify fitType='local' or 'mean' to avoid this message next time.</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; final dispersion estimates</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt; fitting model and testing</span></a></code></pre></div>
<p>DESeq2 also provides a likelihood ratio test. That can be done in a very similar way, by parsing additional arguments to the <code>args</code> parameter.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">reduced =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(<span class="op">~</span><span class="dv">1</span>, <span class="dt">data =</span> exrna<span class="op">$</span>pdata)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">fit3_<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">    exrna, <span class="dt">design =</span> design, <span class="dt">coef =</span> coef, <span class="dt">engin =</span> <span class="st">"DESeq2"</span>,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">    <span class="dt">args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">        <span class="dt">DESeq =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">test =</span> <span class="st">"LRT"</span>, <span class="dt">reduced =</span> reduced)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">    )</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt; using supplied model matrix</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt; estimating size factors</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt; estimating dispersions</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt; gene-wise dispersion estimates</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt; mean-dispersion relationship</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt; -- note: fitType='parametric', but the dispersion trend was not well captured by the</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt;    function: y = a/x + b, and a local regression fit was automatically substituted.</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt;    specify fitType='local' or 'mean' to avoid this message next time.</span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="co">#&gt; final dispersion estimates</span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="co">#&gt; fitting model and testing</span></a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">fit3<span class="op">$</span>results[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(fit3<span class="op">$</span>results<span class="op">$</span>pval),] <span class="op">%&gt;%</span><span class="st"> </span>head <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
logFC
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
stat
</th>
<th style="text-align:right;">
pval
</th>
<th style="text-align:right;">
padj
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ENSG00000103769.10
</td>
<td style="text-align:right;">
-2.5362785
</td>
<td style="text-align:right;">
3.178039
</td>
<td style="text-align:right;">
-2.187611
</td>
<td style="text-align:right;">
0.0286980
</td>
<td style="text-align:right;">
0.961832
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000207757.1
</td>
<td style="text-align:right;">
0.6388898
</td>
<td style="text-align:right;">
27.456948
</td>
<td style="text-align:right;">
2.098345
</td>
<td style="text-align:right;">
0.0358747
</td>
<td style="text-align:right;">
0.961832
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000210077.1
</td>
<td style="text-align:right;">
-0.9371747
</td>
<td style="text-align:right;">
11.433017
</td>
<td style="text-align:right;">
-1.793000
</td>
<td style="text-align:right;">
0.0729729
</td>
<td style="text-align:right;">
0.961832
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000113319.13
</td>
<td style="text-align:right;">
3.6485139
</td>
<td style="text-align:right;">
1.007428
</td>
<td style="text-align:right;">
1.623776
</td>
<td style="text-align:right;">
0.1044235
</td>
<td style="text-align:right;">
0.961832
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000008300.17
</td>
<td style="text-align:right;">
-1.4801477
</td>
<td style="text-align:right;">
4.102517
</td>
<td style="text-align:right;">
-1.623719
</td>
<td style="text-align:right;">
0.1044357
</td>
<td style="text-align:right;">
0.961832
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000116016.14
</td>
<td style="text-align:right;">
-2.7431868
</td>
<td style="text-align:right;">
1.681584
</td>
<td style="text-align:right;">
-1.614479
</td>
<td style="text-align:right;">
0.1064236
</td>
<td style="text-align:right;">
0.961832
</td>
</tr>
</tbody>
</table>
<p>Drawing a volcano plot</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/volcanoplot.ModelFit.html">volcanoplot</a></span>(fit3, <span class="dt">hline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>P value histogram</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(fit3, <span class="dt">vline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div id="edger" class="section level3">
<h3 class="hasAnchor">
<a href="#edger" class="anchor"></a>edgeR</h3>
<p>Similar to DESeq2, edgeR also performes negative binomial glm test. Two models are provided by edgeR, the quasi-likelihood test (QLF) and likelihood ratio test (LRT). <code>model_fit</code> uses QLF by default.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">fit4 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(exrna, <span class="dt">design =</span> design, <span class="dt">coef =</span> coef, <span class="dt">engine =</span> <span class="st">"edgeR"</span>)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">fit4<span class="op">$</span>results[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(fit4<span class="op">$</span>results<span class="op">$</span>pval),] <span class="op">%&gt;%</span><span class="st"> </span>head <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
logFC
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
stat
</th>
<th style="text-align:right;">
pval
</th>
<th style="text-align:right;">
padj
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ENSG00000103769.10
</td>
<td style="text-align:right;">
-2.3437702
</td>
<td style="text-align:right;">
9.869924
</td>
<td style="text-align:right;">
8.578464
</td>
<td style="text-align:right;">
0.0034193
</td>
<td style="text-align:right;">
0.5948105
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000210077.1
</td>
<td style="text-align:right;">
-0.9731867
</td>
<td style="text-align:right;">
11.183599
</td>
<td style="text-align:right;">
7.212137
</td>
<td style="text-align:right;">
0.0072688
</td>
<td style="text-align:right;">
0.5948105
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000207757.1
</td>
<td style="text-align:right;">
0.5768948
</td>
<td style="text-align:right;">
12.224554
</td>
<td style="text-align:right;">
7.091641
</td>
<td style="text-align:right;">
0.0095773
</td>
<td style="text-align:right;">
0.5948105
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000113319.13
</td>
<td style="text-align:right;">
3.9807611
</td>
<td style="text-align:right;">
8.828158
</td>
<td style="text-align:right;">
6.018755
</td>
<td style="text-align:right;">
0.0141937
</td>
<td style="text-align:right;">
0.5948105
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000116016.14
</td>
<td style="text-align:right;">
-2.6752084
</td>
<td style="text-align:right;">
9.264238
</td>
<td style="text-align:right;">
5.501202
</td>
<td style="text-align:right;">
0.0190482
</td>
<td style="text-align:right;">
0.5948105
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000008300.17
</td>
<td style="text-align:right;">
-1.6149331
</td>
<td style="text-align:right;">
9.950162
</td>
<td style="text-align:right;">
5.001152
</td>
<td style="text-align:right;">
0.0253811
</td>
<td style="text-align:right;">
0.5948105
</td>
</tr>
</tbody>
</table>
<p>Drawing a volcano plot</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/volcanoplot.ModelFit.html">volcanoplot</a></span>(fit4, <span class="dt">hline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>P value histogram</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(fit4, <span class="dt">vline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>To use LRT, you need to specify it in the <code>args</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">fit5 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(exrna, <span class="dt">design =</span> design, <span class="dt">coef =</span> coef, <span class="dt">engine =</span> <span class="st">"edgeR"</span>,</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">                 <span class="dt">args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">model =</span> <span class="st">"lrt"</span>))</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">fit5<span class="op">$</span>results[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(fit5<span class="op">$</span>results<span class="op">$</span>pval),] <span class="op">%&gt;%</span><span class="st"> </span>head <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
logFC
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
stat
</th>
<th style="text-align:right;">
pval
</th>
<th style="text-align:right;">
padj
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ENSG00000103769.10
</td>
<td style="text-align:right;">
-2.3437702
</td>
<td style="text-align:right;">
9.869924
</td>
<td style="text-align:right;">
9.981416
</td>
<td style="text-align:right;">
0.0015813
</td>
<td style="text-align:right;">
0.4090667
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000113319.13
</td>
<td style="text-align:right;">
3.9807611
</td>
<td style="text-align:right;">
8.828158
</td>
<td style="text-align:right;">
7.966385
</td>
<td style="text-align:right;">
0.0047654
</td>
<td style="text-align:right;">
0.4090667
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000210077.1
</td>
<td style="text-align:right;">
-0.9731867
</td>
<td style="text-align:right;">
11.183599
</td>
<td style="text-align:right;">
7.378458
</td>
<td style="text-align:right;">
0.0066010
</td>
<td style="text-align:right;">
0.4090667
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000116016.14
</td>
<td style="text-align:right;">
-2.6752084
</td>
<td style="text-align:right;">
9.264238
</td>
<td style="text-align:right;">
6.876766
</td>
<td style="text-align:right;">
0.0087323
</td>
<td style="text-align:right;">
0.4090667
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000207757.1
</td>
<td style="text-align:right;">
0.5768948
</td>
<td style="text-align:right;">
12.224554
</td>
<td style="text-align:right;">
6.693561
</td>
<td style="text-align:right;">
0.0096762
</td>
<td style="text-align:right;">
0.4090667
</td>
</tr>
<tr>
<td style="text-align:left;">
ENSG00000163631.17
</td>
<td style="text-align:right;">
3.6815563
</td>
<td style="text-align:right;">
8.740720
</td>
<td style="text-align:right;">
6.373366
</td>
<td style="text-align:right;">
0.0115846
</td>
<td style="text-align:right;">
0.4090667
</td>
</tr>
</tbody>
</table>
<p>Drawing a volcano plot</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/volcanoplot.ModelFit.html">volcanoplot</a></span>(fit5, <span class="dt">hline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<p>P value histogram</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(fit5, <span class="dt">vline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
</div>
</div>
<div id="complex-models" class="section level2">
<h2 class="hasAnchor">
<a href="#complex-models" class="anchor"></a>Complex models</h2>
<div id="lipidome" class="section level3">
<h3 class="hasAnchor">
<a href="#lipidome" class="anchor"></a>lipidome</h3>
<p><code><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit()</a></code> also supports more complex study design models. The dataset <a href="https://zhuchcn.github.io/HTSet/reference/lipidome.html"><code>lipidome</code></a> is the result of a lipidomics analysis on isolated HDL from 10 human subjects in a 2x2 randomized cross-over study. The study was published on <em>Metabolomics</em>, 2019 (doi: <a href="doi.org/10.1007/s11306-019-1579-1">10.1007/s11306-019-1579-1</a>).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">lipidome</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="co">#&gt; S4 class: HTSet</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="co">#&gt;   nsamples: 40   nfeatures:170</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#&gt;   sample vars: 8 features vars: 15</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co">#&gt; slots:</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">#&gt;   $edata: 170x40 matrix</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#&gt;   $fdata: 170x15 data.frame</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="co">#&gt;   $pdata: 40x8 data.frame</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="co">#&gt;   $assay: 0 list</span></a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(lipidome<span class="op">$</span>pdata[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Treatment"</span>, <span class="st">"Timepoint"</span>)])</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="co">#&gt;  Treatment Timepoint</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="co">#&gt;  FF :20    Post:20  </span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="co">#&gt;  Med:20    Pre :20</span></a></code></pre></div>
<p>In the examples above, we were simply comparing disease patients to control. However in this study, we are asking a slightly more complex question. We would like to see how each lipid species change before and after the two treatments FF and Med. And since each subject was sampled four times, the model that we are using would be as blew. And <span class="math inline">\(\beta_3\)</span> is the coefficient that we would like to test.</p>
<p><span class="math display">\[y = \beta_0 + \beta_1 Treatment + \beta_2 Timepoint + \beta_3 Timepoint*Treatment + \beta_4 Subject + e\]</span></p>
<p>The design matrix should be as below.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co"># in R's equation, ~ Treatment * Timepoint is a shorthand for </span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="co"># ~ Treatment + Timepoint + Treatment * Timepoint</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3">design =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(<span class="op">~</span><span class="st"> </span>Treatment <span class="op">*</span><span class="st"> </span>Timepoint <span class="op">+</span><span class="st"> </span>Subject <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> lipidome<span class="op">$</span>pdata)</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">coef =<span class="st"> "TreatmentMed:TimepointPre"</span></a></code></pre></div>
<p>Because the <code>lipidome</code> is continous data, the limma can be directly applied.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">lipidome2 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/transform_by_sample.html">transform_by_sample</a></span>(lipidome, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(x<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(x)))</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">fit6 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit</a></span>(lipidome2, <span class="dt">design =</span> design, <span class="dt">coef =</span> coef, <span class="dt">engine =</span> <span class="st">"limma"</span>)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">fit6<span class="op">$</span>results[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(fit6<span class="op">$</span>results<span class="op">$</span>pval),] <span class="op">%&gt;%</span><span class="st"> </span>head <span class="op">%&gt;%</span><span class="st"> </span>kable</a></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
logFC
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
stat
</th>
<th style="text-align:right;">
pval
</th>
<th style="text-align:right;">
padj
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
PC 36:2 p 1
</td>
<td style="text-align:right;">
0.9154783
</td>
<td style="text-align:right;">
-8.144336
</td>
<td style="text-align:right;">
5.495343
</td>
<td style="text-align:right;">
0.0000029
</td>
<td style="text-align:right;">
0.0004968
</td>
</tr>
<tr>
<td style="text-align:left;">
PC 34:2 p 1
</td>
<td style="text-align:right;">
0.7227051
</td>
<td style="text-align:right;">
-6.497471
</td>
<td style="text-align:right;">
4.730082
</td>
<td style="text-align:right;">
0.0000316
</td>
<td style="text-align:right;">
0.0018875
</td>
</tr>
<tr>
<td style="text-align:left;">
PC 38:4 p 2
</td>
<td style="text-align:right;">
0.4676405
</td>
<td style="text-align:right;">
-7.948502
</td>
<td style="text-align:right;">
4.713055
</td>
<td style="text-align:right;">
0.0000333
</td>
<td style="text-align:right;">
0.0018875
</td>
</tr>
<tr>
<td style="text-align:left;">
PC 35:2 1
</td>
<td style="text-align:right;">
0.5140877
</td>
<td style="text-align:right;">
-6.833362
</td>
<td style="text-align:right;">
4.583482
</td>
<td style="text-align:right;">
0.0000496
</td>
<td style="text-align:right;">
0.0021068
</td>
</tr>
<tr>
<td style="text-align:left;">
PE 38:4 p
</td>
<td style="text-align:right;">
0.7617776
</td>
<td style="text-align:right;">
-5.707228
</td>
<td style="text-align:right;">
4.326125
</td>
<td style="text-align:right;">
0.0001084
</td>
<td style="text-align:right;">
0.0030950
</td>
</tr>
<tr>
<td style="text-align:left;">
PC 34:2 p
</td>
<td style="text-align:right;">
0.6198772
</td>
<td style="text-align:right;">
-6.737366
</td>
<td style="text-align:right;">
4.323611
</td>
<td style="text-align:right;">
0.0001092
</td>
<td style="text-align:right;">
0.0030950
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/HTSet/man/volcanoplot.ModelFit.html">volcanoplot</a></span>(fit6, <span class="dt">hline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(fit6, <span class="dt">vline =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="statistics_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
</div>
</div>
<div id="the-end" class="section level2">
<h2 class="hasAnchor">
<a href="#the-end" class="anchor"></a>The End</h2>
<p><code><a href="https://rdrr.io/pkg/HTSet/man/model_fit.html">model_fit()</a></code> is simply a wrapper for the statistical pipelines from limma, edgeR, and DESeq2 with a clean interface and output format. You can certainly use limma, edgeR or DESeq2 directly and it is also not too complicated. Sometimes different models may come up with slightly different gene/feature list, however, as long as the model is approciate for the type of data to answer the specific question, your conclusion should be affected much. On thing to bear in mind that although most high through-put experiments are exploratory and hypothesis generating, running all different kinds of models and keep the one with the gene list that you like the most is probably a bad practice and may lead to inappropriate conclusion.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">introduction</a></li>
      <li><a href="#backend-engines">Backend engines</a></li>
      <li><a href="#complex-models">Complex models</a></li>
      <li><a href="#the-end">The End</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Chenghao Zhu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
